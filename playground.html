<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    function bufferToBase64(buf) {
        var binstr = Array.prototype.map.call(buf, function (ch) {
            return String.fromCharCode(ch);
        }).join('');
        return btoa(binstr);
    }

    (async function () {
        const key = await crypto.subtle.generateKey({name: 'AES-GCM', length: 128}, true, ['encrypt', 'decrypt'])
        const text = "confidential message"
// IV must be the same length (in bits) as the key
        const iv = await crypto.getRandomValues(new Uint8Array(16));
        const cyphertext = await crypto.subtle.encrypt({name: 'AES-GCM', tagLength: 32, iv}, key, new TextEncoder().encode(text));

        var result = new Uint8Array(cyphertext);
        var encrypted_data = new Uint8Array(result.length + iv.length);
        encrypted_data.set(iv);
        encrypted_data.set(result, iv.length);

        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "http://localhost:3000/index.php", true);
        let res = bufferToBase64(encrypted_data);
        xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xhttp.send("data="+ res);
    })();
</script>
</body>
</html>
